var toGeoJSON=function(){"use strict";function e(e){if(!e||!e.length)return 0;for(var t=0,r=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t)|0;return r}function t(e,t){return e.getElementsByTagName(t)}function r(e,t){return e.getAttribute(t)}function n(e,t){return parseFloat(r(e,t))}function i(e,r){var n=t(e,r);return n.length?n[0]:null}function o(e){return e.normalize&&e.normalize(),e}function a(e){for(var t=0,r=[];t<e.length;t++)r[t]=parseFloat(e[t]);return r}function s(e){return e&&o(e),e&&e.textContent||""}function l(e,t){var r,n,o={};for(n=0;n<t.length;n++)(r=i(e,t[n]))&&(o[t[n]]=s(r));return o}function u(e,t){for(var r in t)e[r]=t[r]}function f(e){return a(e.replace(y,"").split(","))}function c(e){for(var t=e.replace(d,"").split(v),r=[],n=0;n<t.length;n++)r.push(f(t[n]));return r}function p(e){var t,r=[n(e,"lon"),n(e,"lat")],o=i(e,"ele"),a=i(e,"gpxtpx:hr")||i(e,"hr"),l=i(e,"time");return o&&(t=parseFloat(s(o)),isNaN(t)||r.push(t)),{coordinates:r,time:l?s(l):null,heartRate:a?parseFloat(s(a)):null}}function h(){return{type:"FeatureCollection",features:[]}}function g(e){return void 0!==e.xml?e.xml:m.serializeToString(e)}var m,y=/\s*/g,d=/^\s*|\s*$/g,v=/\s+/;return"undefined"!=typeof XMLSerializer?m=new XMLSerializer:"object"!=typeof exports||"object"!=typeof process||process.browser||(m=new(require("xmldom").XMLSerializer)),{kml:function(n){function o(e){var t,r;return e=e||"","#"===e.substr(0,1)&&(e=e.substr(1)),6!==e.length&&3!==e.length||(t=e),8===e.length&&(r=parseInt(e.substr(0,2),16)/255,t="#"+e.substr(6,2)+e.substr(4,2)+e.substr(2,2)),[t,isNaN(r)?void 0:r]}function l(e){return a(e.split(" "))}function u(e){var r=t(e,"coord","gx"),n=[],i=[];0===r.length&&(r=t(e,"gx:coord"));for(var o=0;o<r.length;o++)n.push(l(s(r[o])));for(var a=t(e,"when"),u=0;u<a.length;u++)i.push(s(a[u]));return{coords:n,times:i}}function p(e){var r,n,o,a,l,h=[],g=[];if(i(e,"MultiGeometry"))return p(i(e,"MultiGeometry"));if(i(e,"MultiTrack"))return p(i(e,"MultiTrack"));if(i(e,"gx:MultiTrack"))return p(i(e,"gx:MultiTrack"));for(o=0;o<k.length;o++)if(n=t(e,k[o]))for(a=0;a<n.length;a++)if(r=n[a],"Point"===k[o])h.push({type:"Point",coordinates:f(s(i(r,"coordinates")))});else if("LineString"===k[o])h.push({type:"LineString",coordinates:c(s(i(r,"coordinates")))});else if("Polygon"===k[o]){var m=t(r,"LinearRing"),y=[];for(l=0;l<m.length;l++)y.push(c(s(i(m[l],"coordinates"))));h.push({type:"Polygon",coordinates:y})}else if("Track"===k[o]||"gx:Track"===k[o]){var d=u(r);h.push({type:"LineString",coordinates:d.coords}),d.times.length&&g.push(d.times)}return{geoms:h,coordTimes:g}}for(var m=h(),y={},d={},v={},k=["Polygon","LineString","Point","Track","gx:Track"],S=t(n,"Placemark"),x=t(n,"Style"),T=t(n,"StyleMap"),N=0;N<x.length;N++){var b=e(g(x[N])).toString(16);y["#"+r(x[N],"id")]=b,d[b]=x[N]}for(var L=0;L<T.length;L++){y["#"+r(T[L],"id")]=e(g(T[L])).toString(16);for(var F=t(T[L],"Pair"),M={},w=0;w<F.length;w++)M[s(i(F[w],"key"))]=s(i(F[w],"styleUrl"));v["#"+r(T[L],"id")]=M}for(var P=0;P<S.length;P++)m.features=m.features.concat(function(e){var n,a=p(e),l={},u=s(i(e,"name")),f=s(i(e,"address")),c=s(i(e,"styleUrl")),h=s(i(e,"description")),g=i(e,"TimeSpan"),m=i(e,"TimeStamp"),k=i(e,"ExtendedData"),S=i(e,"LineStyle"),x=i(e,"PolyStyle"),T=i(e,"visibility");if(!a.geoms.length)return[];if(u&&(l.name=u),f&&(l.address=f),c){"#"!==c[0]&&(c="#"+c),l.styleUrl=c,y[c]&&(l.styleHash=y[c]),v[c]&&(l.styleMapHash=v[c],l.styleHash=y[v[c].normal]);var N=d[l.styleHash];N&&(S||(S=i(N,"LineStyle")),x||(x=i(N,"PolyStyle")))}if(h&&(l.description=h),g){var b=s(i(g,"begin")),L=s(i(g,"end"));l.timespan={begin:b,end:L}}if(m&&(l.timestamp=s(i(m,"when"))),S){var F=o(s(i(S,"color"))),M=F[0],w=F[1],P=parseFloat(s(i(S,"width")));M&&(l.stroke=M),isNaN(w)||(l["stroke-opacity"]=w),isNaN(P)||(l["stroke-width"]=P)}if(x){var R=o(s(i(x,"color"))),z=R[0],G=R[1],A=s(i(x,"fill")),C=s(i(x,"outline"));z&&(l.fill=z),isNaN(G)||(l["fill-opacity"]=G),A&&(l["fill-opacity"]="1"===A?l["fill-opacity"]||1:0),C&&(l["stroke-opacity"]="1"===C?l["stroke-opacity"]||1:0)}if(k){var H=t(k,"Data"),D=t(k,"SimpleData");for(n=0;n<H.length;n++)l[H[n].getAttribute("name")]=s(i(H[n],"value"));for(n=0;n<D.length;n++)l[D[n].getAttribute("name")]=s(D[n])}T&&(l.visibility=s(T)),a.coordTimes.length&&(l.coordTimes=1===a.coordTimes.length?a.coordTimes[0]:a.coordTimes);var U={type:"Feature",geometry:1===a.geoms.length?a.geoms[0]:{type:"GeometryCollection",geometries:a.geoms},properties:l};return r(e,"id")&&(U.id=r(e,"id")),[U]}(S[P]));return m},gpx:function(e){function n(e,r){var n=t(e,r),i=[],o=[],a=[],s=n.length;if(s<2)return{};for(var l=0;l<s;l++){var u=p(n[l]);i.push(u.coordinates),u.time&&o.push(u.time),u.heartRate&&a.push(u.heartRate)}return{line:i,times:o,heartRates:a}}function o(e){var t={};if(e){var r=i(e,"line");if(r){var n=s(i(r,"color")),o=parseFloat(s(i(r,"opacity"))),a=parseFloat(s(i(r,"width")));n&&(t.stroke=n),isNaN(o)||(t["stroke-opacity"]=o),isNaN(a)||(t["stroke-width"]=96*a/25.4)}}return t}function a(e){var n=l(e,["name","cmt","desc","type","time","keywords"]),i=t(e,"link");i.length&&(n.links=[]);for(var o,a=0;a<i.length;a++)o={href:r(i[a],"href")},u(o,l(i[a],["text","type"])),n.links.push(o);return n}var f,c,g=t(e,"trk"),m=t(e,"rte"),y=t(e,"wpt"),d=h();for(f=0;f<g.length;f++)(c=function(e){for(var r,s=t(e,"trkseg"),l=[],f=[],c=[],p=0;p<s.length;p++)(r=n(s[p],"trkpt"))&&(r.line&&l.push(r.line),r.times&&r.times.length&&f.push(r.times),r.heartRates&&r.heartRates.length&&c.push(r.heartRates));if(0!==l.length){var h=a(e);return u(h,o(i(e,"extensions"))),f.length&&(h.coordTimes=1===l.length?f[0]:f),c.length&&(h.heartRates=1===l.length?c[0]:c),{type:"Feature",properties:h,geometry:{type:1===l.length?"LineString":"MultiLineString",coordinates:1===l.length?l[0]:l}}}}(g[f]))&&d.features.push(c);for(f=0;f<m.length;f++)(c=function(e){var t=n(e,"rtept");if(t.line){var r=a(e);u(r,o(i(e,"extensions")));return{type:"Feature",properties:r,geometry:{type:"LineString",coordinates:t.line}}}}(m[f]))&&d.features.push(c);for(f=0;f<y.length;f++)d.features.push(function(e){var t=a(e);return u(t,l(e,["sym"])),{type:"Feature",properties:t,geometry:{type:"Point",coordinates:p(e).coordinates}}}(y[f]));return d}}}();"undefined"!=typeof module&&(module.exports=toGeoJSON);